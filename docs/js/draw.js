import{CANVAS_WIDTH,CANVAS_HEIGHT,RADIUS_HEX,CLUSTERS_MAX,TIMEOUT_SM}from"./info.js";const COLORS=[{color:"#B37FFE",img:void 0},{color:"#B3FF01",img:void 0},{color:"#009302",img:void 0},{color:"#FF7FFE",img:void 0},{color:"#FF7F01",img:void 0},{color:"#B3FFFE",img:void 0},{color:"#FFFF01",img:void 0},{color:"#FF5858",img:void 0}],LINE_WIDTH=9;let colorIndex,ctxBg,ctxFg,dicesBar;async function loadImages(){var e=[];for(let t=0;t<COLORS.length;t++)e.push(new Promise(e=>{let r=new Image;r.onload=()=>{COLORS[t].img=r,e()},r.src=`assets/cube-${t+1}.svg`}));await Promise.all(e)}function setColor(e,r){colorIndex&&(r=colorIndex);var t=COLORS[e];COLORS[e]=COLORS[r],COLORS[r]=t,colorIndex=e}function drawInit(e,r,t){init(t),_drawClusters(r)}function init(e){(ctxBg=document.getElementById("canvas-0").getContext("2d")).clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),ctxFg=[];for(let e=1;e<=CLUSTERS_MAX;e++){var r=document.getElementById("canvas-"+e).getContext("2d");r.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),ctxFg.push(r)}for(var t,c=document.getElementsByClassName("dices-player");0<c.length;)c[0].parentNode.removeChild(c[0]);dicesBar=document.getElementById("dices-bar");for(t of e){var i=document.createElement("div"),d=(i.className="dices-player",i.id=t.id,document.createElement("div")),o=document.createElement("img"),n=(o.src=COLORS[t.id].img.src,document.createElement("span")),a=(n.innerHTML=t.dices,document.createElement("p"));d.append(o,n),i.append(d,a),dicesBar.appendChild(i)}dicesBar.children[0].style="background-color:rgba(255, 165, 0, 0.5)"}function _drawBoard(e){ctxBg.fillStyle="grey",ctxBg.strokeStyle="grey",ctxBg.lineWidth=1;for(var r of e){ctxBg.fillText(String(r.id),r.hex.center.x-2,r.hex.center.y+4),ctxBg.beginPath();for(var t of r.hex.corners)ctxBg.lineTo(t.x,t.y);ctxBg.closePath(),ctxBg.stroke()}}function _drawClusters(e){for(var r of e)_drawCluster(r.corners,"black",LINE_WIDTH,COLORS[r.playerId].color),_drawDices(r)}function drawCluster(e,r){void 0===r?_drawCluster(e,"red",LINE_WIDTH-1,"rgba(255, 255, 255, 0.8)"):_drawCluster(e,"black",LINE_WIDTH,COLORS[r].color)}function _drawCluster(e,r,t,c){ctxBg.beginPath();for(var i of e)ctxBg.lineTo(i.x,i.y);ctxBg.lineTo(e[0].x,e[0].y),ctxBg.lineTo(e[1].x,e[1].y),ctxBg.strokeStyle=r,ctxBg.lineWidth=t,ctxBg.stroke(),ctxBg.fillStyle=c,ctxBg.fill()}function drawDices(e,r){void 0===r&&ctxFg[e.id].clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),_drawDices(e,{startI:r})}async function _drawDices(t,{timeout:c=TIMEOUT_SM,startI:e=0}={}){let i=t.center.x-30,d=t.center.y-20;let o=ctxFg[t.id];for(let r=0;r<t.dices;r++)4===r&&(i+=16,d+=8),r<e||await new Promise(e=>{setTimeout(()=>{o.drawImage(COLORS[t.playerId].img,i,d-r%4*20,50,50),e()},c)})}function _drawText(e){var r=RADIUS_HEX/2+2,t=e.center.x-RADIUS_HEX/2-4*Math.floor(e.id/10),r=e.center.y+r;ctxFg[e.id].fillStyle="black",ctxFg[e.id].font="40px Standard",ctxFg[e.id].fillText(e.id,20+t,r-20)}function drawDicesNums(e){dicesBar.children.namedItem(e.id).children[0].children[1].innerHTML=e.dices,0<e.additionalDices?dicesBar.children.namedItem(e.id).children[1].innerHTML="+"+e.additionalDices:dicesBar.children.namedItem(e.id).children[1].innerHTML=""}function drawDicesBar(e,r){dicesBar.children.namedItem(e).style="background-color:none",dicesBar.children.namedItem(r).style="background-color:rgba(255, 165, 0, 0.5)"}function deletePlayerFromDicesBar(e){dicesBar.removeChild(dicesBar.children.namedItem(e))}export{loadImages,setColor,drawInit,drawCluster,drawDices,drawDicesNums,drawDicesBar,deletePlayerFromDicesBar};