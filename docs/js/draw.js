import{CANVAS_WIDTH,CANVAS_HEIGHT,RADIUS_HEX,TIMEOUT_SM}from"./info.js";const COLORS=[{color:"#B37FFE",img:void 0},{color:"#B3FF01",img:void 0},{color:"#009302",img:void 0},{color:"#FF7FFE",img:void 0},{color:"#FF7F01",img:void 0},{color:"#B3FFFE",img:void 0},{color:"#FFFF01",img:void 0},{color:"#FF5858",img:void 0}],LINE_WIDTH=9;let colorIndex,ctxBg,ctxFg=[],dicesBar;async function loadImages(){var e=[];for(let t=0;t<COLORS.length;t++)e.push(new Promise(e=>{let r=new Image;r.onload=()=>{COLORS[t].img=r,e()},r.src=`assets/cube-${t+1}.svg`}));await Promise.all(e)}function setColor(e,r){colorIndex&&(r=colorIndex);var t=COLORS[e];COLORS[e]=COLORS[r],COLORS[r]=t,colorIndex=e}function setBackgroundCtx(e){ctxBg=e.getContext("2d")}function setForegroundCtx(e){ctxFg.push(e.getContext("2d"))}function drawInit(e,r,t){init(t),_drawClusters(r)}function init(e){ctxBg.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);for(var r of ctxFg)r.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);for(var t,c=document.getElementsByClassName("dices-player");0<c.length;)c[0].parentNode.removeChild(c[0]);dicesBar=document.getElementById("dices-bar");for(t of e){var i=document.createElement("div"),o=(i.className="dices-player",i.id=t.id,document.createElement("div")),n=document.createElement("img"),d=(n.src=COLORS[t.id].img.src,document.createElement("span")),a=(d.innerHTML=t.dices,document.createElement("p"));o.append(n,d),i.append(o,a),dicesBar.appendChild(i)}dicesBar.children[0].style="background-color:rgba(255, 165, 0, 0.5)"}function _drawBoard(e){ctxBg.fillStyle="grey",ctxBg.strokeStyle="grey",ctxBg.lineWidth=1;for(var r of e){ctxBg.fillText(String(r.id),r.hex.center.x-2,r.hex.center.y+4),ctxBg.beginPath();for(var t of r.hex.corners)ctxBg.lineTo(t.x,t.y);ctxBg.closePath(),ctxBg.stroke()}}function _drawClusters(e){for(var r of e)_drawCluster(r.corners,"black",LINE_WIDTH,COLORS[r.playerId].color),_drawDices(ctxFg[r.id],r)}function drawCluster(e,r){void 0===r?_drawCluster(e,"red",LINE_WIDTH-1,"rgba(255, 255, 255, 0.8)"):_drawCluster(e,"black",LINE_WIDTH,COLORS[r].color)}function _drawCluster(e,r,t,c){ctxBg.beginPath();for(var i of e)ctxBg.lineTo(i.x,i.y);ctxBg.closePath(),ctxBg.strokeStyle=r,ctxBg.lineWidth=t,ctxBg.stroke(),ctxBg.fillStyle=c,ctxBg.fill()}function drawDices(e,r){var t=ctxFg[e.id];void 0===r&&t.clearRect(e.center.x-30,e.center.y-80,80,120),_drawDices(t,e,{startI:r}).then(()=>{})}async function _drawDices(t,c,{timeout:i=TIMEOUT_SM,startI:e=0}={}){let o=c.center.x-30,n=c.center.y-20;for(let r=0;r<c.dices;r++)4===r&&(o+=16,n+=8),r<e||await new Promise(e=>{setTimeout(()=>{t.drawImage(COLORS[c.playerId].img,o,n-r%4*20),e()},i)})}function _drawText(e,r){var t=RADIUS_HEX/2+2,c=r.center.x-RADIUS_HEX/2-4*Math.floor(r.id/10),t=r.center.y+t;e.fillStyle="black",e.font="40px Standard",e.fillText(r.id,20+c,t-20)}function drawDicesNums(e){dicesBar.children.namedItem(e.id).children[0].children[1].innerHTML=e.dices,0<e.additionalDices?dicesBar.children.namedItem(e.id).children[1].innerHTML="+"+e.additionalDices:dicesBar.children.namedItem(e.id).children[1].innerHTML=""}function drawDicesBar(e,r){dicesBar.children.namedItem(e).style="background-color:none",dicesBar.children.namedItem(r).style="background-color:rgba(255, 165, 0, 0.5)"}function deletePlayerFromDicesBar(e){dicesBar.removeChild(dicesBar.children.namedItem(e))}export{loadImages,setColor,setBackgroundCtx,setForegroundCtx,drawInit,drawCluster,drawDices,drawDicesNums,drawDicesBar,deletePlayerFromDicesBar};